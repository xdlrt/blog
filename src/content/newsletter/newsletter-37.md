---
title: "一颗小树 #37 基于多维表格的可转债投资系统"
postSlug: 1ef380cf
pubDatetime: 2022-11-06T20:28:20.000Z
tags:
  - newsletter
description: 数字化从来都不是少数人的权利，而是千行百业共同进步。每一个人、每一个组织、每一家企业都应该享受到数字化的红利。
---

> 你好，我是小树。这是我为你写的第 37 封信。每期都会同步更新在微信公众号[一颗小树](https://weixin.sogou.com/weixin?query=a_warm_tree)和[竹白专栏](https://xiaoshu.zhubai.love)。现在有 129 位朋友订阅了这封信，也欢迎你[邮件订阅](https://xiaoshu.zhubai.love)，第一时间收到更新推送。

书接上回[初探多维表格](https://mp.weixin.qq.com/s/M27pTinwH0jV28NjhLfaHw)，继上次基础的产品功能体验之后，打算利用多维表格解决一个实际问题，更深入的感受产品带来的便利。

最终决定实现一套基于可转债双低策略的业务系统，提高决策的效率。

希望了解策略本身可以查看毛老师的[如何搭建一个双低转债投资系统](https://mp.weixin.qq.com/s/aQ1E1HpbV7utegAOweY-cw)。

本文接下来的重点是讲述利用飞书多维表格构建业务系统的核心思路，不包含太多技术细节。

### 需求分析

作为投资策略，决定需要购买的品种是最关键的环节之一，在投资系统中，我们对目标标的的定义如下：

> 集思录曾经定义过一个双低值的概念：
> 可转债的双低值 = 可转债价格 + 溢价率 \* 100
> 当排序后双低值越小的品种，越值得买入。这是我的出手标准。
> 由于我个人是风险厌恶者。可交换债、已经发了强赎公告、剩余时间小于 1 年，这三个条件只要满足一个，也会都剔除掉，留足安全边际。

因此，我们的需求如下：

1. 获取可转债的数据，包括但不限于：代码、可转债名称、可转债双低值、可转债类型、到期时间、强赎公告信息。
2. 支持过滤可交换债、到期时间小于 1 年以及发布强赎公告的债券
3. 支持双低值由小到大排序

最终得到的数据结果，就是值得买入的优先级。

### 设计表结构

参照需求 1 中的数据字段，可以直接转换成飞书多维表格的列类型。这里用到了多行文本、数字、单选和日期类型。

效果如下：

![](/images/newsletter-37/1.png)

### 获取数据

我们选取了比较权威和全面的集思录数据，由于需要登录之后才能获取完整的可转债数据，最后选择了基于 Node.js 的自动化测试框架，来实现模拟登录和获取页面数据。

最后综合考虑运行成本和稳定度，通过 Playwright + Github Actions 的组合，实现了定时拉取集思录数据。

由于策略本身不依赖行情的实时性，因此每天只会拉取一次。

数据爬虫的具体实现方式这里不再赘述。

### 输入数据

接下来是我们的重头戏，我们拉取到可转债的数据之后，应该如何输入到飞书多维表格中呢？

最初我希望通过自动化流程来实现输入，但由于拉取的数据本身不会持久到数据库中，没办法通过客户端定时调用实现，并且自动化流程中的操作还没办法很好地解析数组类型的数据，最终此路不通。

除了自动化流程以外，飞书还具有 HTTP 方式调用服务端 API 的开放能力。

![](/images/newsletter-37/feishu-1.png)

使用此能力，流程相对更繁琐，需要具备一定的开发能力。

流程如下：

1. 在飞书中加入/创建企业，目前没有限制，可以自己建一个
2. 在开发者后台创建企业自建应用
   ![](/images/newsletter-37/feishu-2.png)

3. 应用后台 -> 权限管理中开通 bitable:app 权限，为多维表格的服务端 API 提供权限
   ![](/images/newsletter-37/feishu-3.png)

4. 为应用创建新版本，提交企业管理员审核，自建企业会方便一些，可以自行审核通过，审核通过后发布即可
   ![](/images/newsletter-37/feishu-4.png)

5. 在多维表格文件中，从右上角的「...」找到更多 -> 添加文档应用，添加将刚才发布的应用
   ![](/images/newsletter-37/feishu-5.png)

至此，就具备了通过服务端 API 实现此文件内容增删改查的能力。

搭建系统的核心逻辑如下：

![](/images/newsletter-37/2.png)

### 处理业务逻辑

由于暂时没有找到强赎公告相关数据，我们当前需要做两步操作：

1. 数据筛选：剔除可交换债，过滤出剩余年限大于 1 年的可转债

![](/images/newsletter-37/3.png)

2. 数据排序：根据可转债的双低值，从小到大进行排序

![](/images/newsletter-37/4.png)

如果我们希望进一步增加安全边际，可以再筛选出现价小于 100 的可转债。最终效果如下：

![](/images/newsletter-37/5.png)

至此，我们就获得了最适合此策略投资的可转债。

### 一些感想

可转债投资是一个简单但很典型的业务场景，如果按照惯常的开发方式，我们需要解决无数细节问题，如前后端开发、公网访问和用户鉴权等。

整个流程下来，除了不小的时间投入，也会产生持续的运维成本。

但通过多维表格，一站式解决了数据库、UI 和业务逻辑的能力，叠加可以内置的应用能力以及服务端 API，极大地拓展了多维表格的场景，让它能够和已有的业务系统和数据串联起来，具备强大的协同效应。

整个系统花费半天时间，并且完全免费。当然，真实的企业场景也会需要付费，但综合成本要低的多。

低成本享受数字化红利，是未来互联网的一个重要命题，我也在持续学习中。

最后，用不穷在[钉钉总裁叶军：企业数字化，CEO 的第一战略](https://mp.weixin.qq.com/s/C1e00XvF2k5TevmonCj_KA)采访中的话来结束吧：“数字化帮助企业在不确定性中寻找确定性，这是时代的进步。钉钉认为数字化从来都不是少数人的权利，而是千行百业共同进步。每一个人、每一个组织、每一家企业都应该享受到数字化的红利。钉钉要做好数字经济时代的服务者。”

### 碎碎念

公司自动售货机里的特价三得利乌龙茶断货了，难过...

谢谢你的关注，我们下期再见。👋🏻

---

### 往期推荐

- [一颗小树 #34 初探多维表格](https://mp.weixin.qq.com/s/M27pTinwH0jV28NjhLfaHw)
- [一颗小树 #32 生活需要留白](https://mp.weixin.qq.com/s/Xk4U-9x5dsz2vjOoxPfLZQ)
- [一颗小树 #31 Figma 的成功之道](https://mp.weixin.qq.com/s/O-0ExGALEZAkhVJKBOV9Pw)

你也可以在这里找到我：[即刻](https://okjk.co/3Vsn5T)、[Twitter](https://twitter.com/yeshu_in_future)、微信公众号[一颗小树](https://weixin.sogou.com/weixin?query=a_warm_tree)。

> 这里是小树的 [newsletter](https://xiaoshu.zhubai.love)。 每周一发布，欢迎[订阅](https://xiaoshu.zhubai.love)。
> 如果你觉得这篇文章对你有用，欢迎分享给更多好友。
